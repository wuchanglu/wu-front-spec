<!--
 * @Author: 吴昌禄 wuzhanglu@qq.com
 * @Date: 2025-01-17 01:15:52
 * @LastEditors: 吴昌禄 wuzhanglu@qq.com
 * @LastEditTime: 2025-01-17 14:21:20
 * @FilePath: /wu-front-spec/packages/wucl-fe-lint/实现流程.md
 * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE
-->

# 实现流程

## 1. 用户执行脚本命令的时候

1. 先执行 cli 文件.ts 文件
2. 使用 commander 工具的 program 来解析用户输入的命令
3. 先调用.version 来设定当前工具包的版本号，版本信息和包名是从 package.json 中读取的
4. 调用.description 来设定当前工具包的描述信息
5. 调用.command 来接受用户命令并作处理 类似这种 sh 命令 `wucl-fe-lint init`
6. 注册了 init(一键接入集成)、commit-msg-scan（git commit 时扫描用）、update(更新工具包)
7. 调用.parse 来解析用户输入的命令

- init 里面主要是 判断是否传入--vscode 参数来判断
  - 是的话就读区包内的 vscode 配置文件，然后和用户本地的 vscode 配置文件进行合并输出(相同属性配置，会覆盖用户之前的)
  - 不是的话就走 init 函数进行 lint 工具的初始化引入
- commit-msg-scan
  - 调用 commitlint-cli 的脚本指令进行 commit message 的扫描检查
- update
  - 更新工具包

## init 函数实现流程(非 test 情况下)

1. 检查包版本，需要更新的话就提示用户可以更新
2. 初始化配置项 enableESLint 为 true
3. 初始化 eslintType 让用户选择 eslint 的类型
4. 初始化 enableStylelint，让用户选择要不要使用 stylelint
5. 初始化 enableMarkdownlint，让用户选择要不要使用 markdownlint
6. 初始化 enablePrettier，让用户选择要不要使用 prettier
7. 检查 eslint 所需的依赖，找出用户已存在的部分配置文件标记为带删除，找出用户已存在的部分配置文件标记为带覆盖，提示用户哪些依赖要删除，哪些配置要删除，哪些配置要覆盖，让用户确认是否继续
8. 确认后就进行处理，修改 package.json 的依赖项，删除配置文件
9. 安装依赖项 跑 install -D wucl-fe-lint
10. 更新 package.json 设置 scripts 把 lint 工具支持的脚本命令都添加到 package.json 的 scripts 里面
11. 设置 package.json 里面的 husky 的 hooks 来设置 git commit 的卡口 进行每次 commit 之前的校验
12. 调用 generateTemplate 创建并写入配置文件 eslintrc.js、eslintignore、.editorconfig、.markdownlint.json、.markdownlintignore、.prettierrc.js、.stylelintignore、.stylelintrc.js、commitlint.config.js、wucl-fe-lint.config.js
13. 完成之后提示信息，结束

## update 函数实现流程

1. 用 ora 在控制台 显示检查版本的 loading
2. 检查是否存在更新的版本号，如果存在就更新
3. 获取当前支持的包管理工具优先 pnpm
4. 调用 child_process 模块的 execSync 开启子线程 执行 `npm i -g wucl-fe-lint`或者`pnpm i -g wucl-fe-lint` 来进行包更新
5. 更新完成之后提示信息，结束
